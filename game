MASTER PROMPT — Troll City Gamer Section Page: GameTrollz (Streaming + Gamer Profiles)

Build a new authenticated gamer hub inside the existing Troll City web app called GameTrollz. This is a full page/module with its own layout and sidebar. It must match the Troll City theme (dark/neon, clean modern cards, glow accents) and integrate with the existing auth, users table, wallet/troll coin balance, and broadcast system. No mock data. No placeholders. Everything must be wired end-to-end.

1) Routing + Access Control

Add route: /gametrollz

Only logged-in users can access

If not logged in → redirect to /login

Add navigation entry: “GameTrollz”

2) Page Layout (Required)

This page uses a two-column layout:

Left Sidebar (persistent)

Sidebar must show current logged-in gamer:

Profile picture (avatar)

Username / gamer alias (display name)

Troll Coin balance (live from wallet)

Gamer Tags (chips/badges)

A small “Edit” link that opens Profile Settings (not public edit)

Sidebar menu items (vertical):

Overview

Stream

Clips

Links

Settings

Rules:

Sidebar content updates live after profile edit

Gamer Tags are editable only via Settings

3) Header (Top Bar)

Header includes:

Page title: GameTrollz

Right side:

“Edit Gamer Profile” button (only visible to the logged-in gamer viewing their own profile/dashboard)

“Go to Broadcast Profile” button/link that opens their broadcast profile page

When viewing someone else’s profile (if you allow public profiles later), hide edit controls.

4) Core Feature: Gamer Profile Settings (Edit Panel)

Create a dedicated settings view or modal opened from:

Sidebar “Settings”

Header “Edit Gamer Profile”

Settings fields:

Identity

Gamer alias / display username

Avatar upload (store in storage bucket)

Bio

Gamer tags (multi-select or comma input → stored as array)

Links (IMPORTANT)
Allow users to add and manage multiple links:

Twitch

YouTube

Kick

TikTok

Discord

Instagram

X (Twitter)

Steam / PSN / Xbox / Battle.net

Custom links (label + URL)

Validation:

URL format validation

Prevent duplicates

Limit max links (e.g., 12)

Broadcast integration requirement:

These links must also appear on the user’s broadcast profile automatically.

Implement this as shared data: the broadcast profile reads from the same links table (or synced view), not a second copy.

5) Overview Tab (Dashboard)

Overview shows:

“Streamer Status” card: Connected / Not connected + last stream time

“Coins Earned From Streaming” (if tracked)

Recent activity (last 10 events): profile updates, stream sessions, clips uploaded

“Top Clips” (if clips exist)

Everything must come from DB tables / live services.

6) Streaming to Troll City (Main Requirement)

Gamers must be able to stream their gameplay to Troll City.

Implement Stream tab with two modes:

Mode A — Embed External Stream

User connects Twitch/YouTube/Kick link in Settings

Stream tab automatically detects if they have a primary stream link

Show embedded player (iframe) for Twitch/YouTube (Kick if supported)

If no link → show “Connect your stream link” CTA

Mode B — Native Troll City Broadcast Integration
Integrate with your existing broadcast system:

Add a “Start Game Stream” button

Starting a stream creates/updates a “broadcast session” entry tied to the gamer

Gamer can choose:

Title

Category: “Gaming”

Game name

Tags

Visibility (public/followers)

The stream must appear on the main Troll City broadcast discovery feed under a “Gaming” category.

If you already have broadcast tables, reuse them. If not, add:

broadcast_sessions with category, game_name, created_by, status, timestamps

Ensure RLS + only creator can manage their session

7) Clips Tab

Clips system:

Upload clips (mp4/webm), store in bucket

Clip fields:

title, game, tags, visibility

Clips appear on:

GameTrollz profile

Broadcast profile (if enabled)

Allow delete/edit only by owner/admin.

8) Links Tab (Public display)

Display all links in clean cards with icons.

“Primary link” concept (the one used for Stream embedding)

Allow reorder links (drag/drop) and persist order

9) Data Model (Create if missing)

Use Supabase Postgres.

game_profiles

user_id (PK, references auth.users)

gamer_alias

avatar_url

bio

gamer_tags (text[])

primary_stream_provider (text)

primary_stream_url (text)

timestamps

profile_links

id uuid pk

user_id fk

provider (enum-like text: twitch, youtube, kick, etc.)

label (optional)

url

sort_order int

timestamps

game_clips

id uuid pk

user_id fk

title

game

tags text[]

clip_url

visibility (public/private/followers)

timestamps

(If wallet already exists, read troll coin balance from it. If not:)

wallets

user_id pk

troll_coins numeric

timestamps

wallet_transactions

for clip/stream earnings if you implement rewards

10) RLS / Security Rules (Mandatory)

game_profiles: user can read public profiles (optional), but only update their own

profile_links: only owner can insert/update/delete; public read allowed if profile is public

game_clips: public read if visibility = public; only owner can write

Upload buckets must enforce per-user folder restrictions

All writes must be validated server-side (edge functions if needed).

11) UI Requirements (Troll City Theme)

Dark base, neon accent glows

Clean spacing, professional gamer vibe (not childish)

Sidebar uses compact cards

Use skeleton loaders

Empty states should be styled (not blank)

Mobile:

Sidebar collapses into drawer

Header stays sticky

12) Completion Criteria

Do not mark complete unless:

/gametrollz loads with sidebar + header

Avatar/alias/tags save and persist

Coin balance is live

Links save and show on broadcast profile

Stream tab supports embed + broadcast category “Gaming”

Clips upload and display works

No mock data anywhere

RLS prevents other users editing someone else

MASTER PROMPT — GameTrollz Tournaments (Coins Only) with 20% Platform Fee + Admin Toggle + Auto Start

Implement the GameTrollz tournaments system under /gametrollz with coin-only entry/payouts. This system must include a fixed entry fee, an automatic platform fee, an admin treasury pool, and an “Allow Tournaments” switch that controls auto-start behavior. No PayPal, no cash, no mock data.

1) Global Settings (Admin Toggle)

Create a global settings mechanism:

platform_settings.allow_tournaments boolean (default false)

Only Admin can change it
Behavior:

If allow_tournaments = false:

Users may view tournaments, but cannot join

Tournaments cannot auto-start or be finalized

If Admin clicks “Allow Tournaments” (sets to true):

System must automatically transition eligible tournaments from “upcoming” → “live” when conditions are met (see Auto Start rules)

2) Fixed Entry Fee + Platform Fee

Tournament entry fee is fixed:

ENTRY_FEE_COINS = 1000 (no per-tournament override)

Platform fee is fixed:

PLATFORM_FEE_RATE = 0.20 (20%)

On join:

Deduct 1000 from user wallet (atomic transaction)

Split the funds:

200 coins to Admin Pool (Treasury)

800 coins to Tournament Prize Pool

Create ledger entries for each movement

3) Tournament Pools + Admin Pool Accounting

Track three pools per tournament:

gross_pool_coins (sum of all entries, should equal 1000 * participants_paid)

platform_fee_coins (20% of gross, routed to admin pool)

prize_pool_coins (80% of gross, used for winners)

Also track Admin Pool (Treasury) globally:

admin_treasury.balance_coins increases by platform fees across all tournaments

Must be auditable and never editable without ledger logs

4) Auto Start Logic (System Automatic)

When allow_tournaments = true, a tournament should auto-start when:

status = upcoming

start_at <= now()

participants_paid >= min_players (new required field)

tournament not cancelled
Then system sets:

status = live

generates matches/bracket (if needed)
This auto-start must run either via:

DB trigger + function, OR

scheduled job/cron, OR

server-side “on page load” reconciliation (but must be reliable)
Do not require the admin to manually click “Start” per tournament; only the global allow toggle is required.

5) Admin Pool Requirement (“needs to be added to admin pool”)

Platform fees must be credited to an Admin treasury wallet/pool automatically:

Admin dashboard shows:

Treasury balance

Fees earned today/7d/30d

Fees by tournament

Admin pool is not the same as “prize pool”

Prize pool is locked to tournament payouts only

6) Database Changes (Create if missing; reuse wallet tables if present)
platform_settings

id (single row)

allow_tournaments boolean default false

updated_by

updated_at

admin_treasury

id (single row)

balance_coins bigint default 0

updated_at

tournaments (add fields / ensure fields exist)

id

title

game

status (draft/upcoming/live/completed/cancelled)

start_at

min_players (int required)

max_players

entry_fee_coins (store but must always be 1000)

gross_pool_coins bigint default 0

platform_fee_coins bigint default 0

prize_pool_coins bigint default 0

created_by

timestamps

wallet_transactions (must exist)

Every join creates 2 ledger rows:

tournament_entry = -1000 (user wallet)

tournament_prize_pool_credit = +800 (tournament reference)

tournament_platform_fee = +200 (admin treasury reference)
(You can implement #2/#3 as a single system ledger table, but it must be auditable and attributable.)

Recommended additional ledger table for pools:

system_ledger

id

type (tournament_prize_pool_credit, tournament_platform_fee)

amount_coins

reference_type (tournament/admin_treasury)

reference_id

from_user_id nullable

created_at

7) Server-Side Transaction Safety (Mandatory)

Joining a tournament must be a single atomic operation:

Check allow_tournaments = true

Check rules accepted

Check tournament status upcoming, not full

Check user wallet >= 1000

Deduct wallet

Increment tournament pools:

gross += 1000

platform_fee += 200

prize_pool += 800

Increment admin_treasury.balance += 200

Insert participant row

Insert ledger records
If any step fails, everything rolls back.

8) RLS / Permissions

Only Admin can edit platform_settings and admin_treasury directly

Users cannot write to tournament pools or treasury; only server-side function can

Users can join only as themselves

9) UI Requirements

In tournament cards and detail pages show:

Entry: 1000 coins

Prize pool: live prize_pool_coins

Platform fee: 20% (display in rules + detail page)
On join error messages:

“Tournaments are currently disabled by Admin”

“You need 1000 Troll Coins”

“Rules not accepted”

“Tournament full”

“Tournament already started”

10) Completion Criteria

Do not mark complete unless:

Funds split correctly: 200 to admin treasury, 800 to prize pool

Admin toggle gates joining and auto-start

Auto-start works reliably when allow_tournaments is enabled

All ledger and pool changes are auditable

No mock data

Implementation detail (so Trae doesn’t mess it up)

Best practice: implement a DB function like:

join_tournament(tournament_id uuid)
Runs with elevated privileges (service role / security definer) and performs the atomic split.

And another function/job:

auto_start_tournaments()
Runs every minute (cron) OR is invoked when admin sets allow_tournaments=true, and starts anything eligible.